# 📝 개인 공부
### 공유 자원이란 무엇이며, 왜 시스템에서 공유 자원을 사용해야 할까요? 실생활 또는 개발 경험에 빗대어 설명해주세요.

공유자원이란, 여러 사용자나 프로세스가 동시에 접근하거나 사용하는 시스템 내의 자원을 의미합니다. 예를 들어 제가 개발했던 도서관 시스템에서 책이 있습니다.

한 권의 책을 여러 사람이 대출할 수 있고, 누군가 책을 대출 중이라면, 다른 사람은 대출할 수 없습니다. 이는 시스템에서도 동일하게 적용될 수 있습니다.

시스템에서 공유자원을 사용하는 이유는, 자원을 효율적으로 활용할 수 있고, 데이터를 일관성 있게 관리하며, 시스템을 확장적으로 사용할 수 있기 때문입니다.

---
### 임계 영역의 정의와 중요성을 설명하고, 임계 영역을 보호하지 않았을 때 발생할 수 있는 가장 심각한 문제는 무엇이라고 생각하십니까?

임계영역이란, 공유자원에 접근하는 프로그램 코드의 일부분입니다. 임계영역을 사용함으로써, 데이터 무결성을 유지할 수 있고, 경합조건도 방지할 수 있기 때문에 중요합니다.

만약 임계영역을 보호하지 않는다면, 데이터 불일치의 문제가 발생할 수 있습니다.

데이터 불일치는 여러 곳에서 나타날 수 있는데, 재고 관리를 할 때 현재 재고보다 더 많은 주문을 받을 수 있고, 항공권을 예매할 때 동일 좌석에 대해 중복 예약도 발생할 수 있습니다.

---
### 동기화 메커니즘이 필요한 이유를 데이터 무결성과 관련지어 설명해주세요. 동기화가 없다면 발생할 수 있는 문제 3가지 이상을 예시와 함께 설명해주세요.

동기화가 없다면, 다음과 같은 문제가 발생할 수 있습니다.

1. Race condition 

티켓 예매 시스템을 예시로 들겠습니다. 해당 좌석이 예매 가능 상태일 때, 사용자 A와 사용자 B가 좌석의 상태를 확인했을 때, 두 사용자 모두 “예매 가능” 상태라고 확인했습니다. 

A가 예매를 완료하여 좌석 상태를 “예매됨”으로 변경하고자 하였지만, B도 예매를 완료하여 같은 좌석이 중복으로 예매됩니다.

2.  Lost Update

온라인 쇼핑몰 재고 관리 상황을 말씀 드리겠습니다. 해당 상품의 재고가 10개 있을 때, 고객 A가 3개를 구매하고, 동시에 고객 B가 4개를 구매한다고 가정합니다. 

시스템은 A의 구매로 재고를 7개로 갱신하지만, B의 구매처리가 A의 갱신을 덮어 쓰면서 재고를 6개로만 갱신합니다. 재고 차감이 원활하게 되지 않아 데이터가 부정확해집니다. 

3. Deadlock

데이터베이스 트랜잭션 상황을 말씀 드리겠습니다. 트랜잭션 A가 테이블 X의 행을 잠그고, 트랜잭션 B가 테이블 Y의 행을 잠군 상황입니다.

A가 Y의 데이터가 필요해서 잠금을 요청하고, B가 X의 데이터가 필요하여 잠금을 요청할 때, 두 트랜잭션 모두 서로가 필요한 자원을 잠그고 있어 영원히 진행되지 않습니다. 

이러한 문제를 방지하기 위해 동기화 매커니즘이 필요합니다. 동기화를 통해, 데이터 접근을 순차적으로 제어하여 일관성을 보장하고, 공유 자원에 대한 접근을 관리하며 데이터 무결성을 유지시킵니다. 또한 실행 순서를 조정하여 예측 가능한 결과를 보장합니다. 

---
### 락의 기본적인 개념과 동작 방식을 설명해주세요. 락이 데이터 무결성을 어떻게 보장하는지 원자성 개념과 함께 설명해주시면 좋겠습니다.

락이란, 하나의 스레드나 프로세스가 자원을 점유할 경우, 다른 스레드/프로세스가 해당 자원에 접근하지 못하도록 제어하는 기법입니다. 

한 스레드가 자원을 점유할 경우, 그 자원은 Lock 상태에 들어가며 다른 스레드/프로세스가 접근할 수 없습니다. 이후 각 종류에 따라 해당 자원에 접근하고자 하는 다른 스레드/프로세스를 관리하고, 첫 스레드가 unlock 상태로 변경되면 다른 스레드가 자원에 접근할 수 있다.

원자성은, 작업 단위가 더 이상 나뉠 수 없는 하나의 “원자적” 실행 단위로 동작함으로 보장하는 개념입니다. 락을 사용하였을 때, 다른 스레드의 작업을 방지하여 특정 작업단위가 중단 없이 완전하게 실행될 수 있습니다. 

---
### 뮤텍스와 세마포어의 차이점을 설명하고, 각각 어떤 상황에서 사용하는 것이 적절한지 예시를 들어 설명해주세요.

뮤텍스란, 공유된 자원의 데이터/임계영역 등에 하나의 프로세스 혹은 스레드만 접근할 수 있도록 하는 동기화 객체입니다. 

이때, 소유권의 개념이 있어 뮤텍스를 획득한 스레드만 해제할 수 있습니다. 

세마포어는 공유된 자원의 데이터/임계영역 등에 여러 프로세스 혹은 스레드가 접근하도록 하는 동기화 객체입니다. 소유권이 없어 어느 스레드든 신호를 보낼 수 있습니다. 

뮤텍스의 예시로, 은행 ATM기기와 1인용 화장실을 예시로 들 수 있습니다. 이때, 이 ATM기기와 화장실은 한 번에 한명의 고객만 이용할 수 있고, 사용 중일 때 다른 사람은 접근할 수 없기 때문에 뮤텍스입니다.

세마포어는 주차장 관리가 있습니다. 주차장에 많은 주차공간이 있고, 빈 공간이 있다면 다른 차가 들어올 수 있지만, 자리가 없다면 입구에서 대기해야 합니다. 

---
### 조건 변수(Condition Variable)는 왜 뮤텍스와 함께 사용해야 할까요? 조건 변수의 역할과 뮤텍스와의 협력 관계를 설명해주세요.

뮤텍스 만을 이용하여 동기화를 하는 것은, 프로세스가 뮤텍스 변수를 지속적으로 검사해야 하는 단점이 있습니다. 조건변수를 사용한다면, 특정 조건이 만족될 때까지 대기했다가 조건이 만족되면 깨어나서 작업을 진행하는 편리함이 있다. 

뮤텍스와 조건변수를 같이 사용할 때, 뮤텍스는 공유 데이터를 보호하고, 원자적 연산을 보장받습니다. 그리고 조건변수는 효율적인 대기와 정확한 신호 전달을 통해 안전하고 효율적인 동기화를 달성할 수 있습니다.

---
### 뮤텍스는 데드락 발생 가능성이 있습니다. 데드락의 발생 조건 4가지를 설명하고, 데드락을 예방하기 위한 방법 3가지 이상을 제시해주세요.

데드락의 발생 조건은, 뮤텍스, 점유대기, 비선점, 순환대기가 있습니다. 

- 뮤텍스 : 자원은 한 번에 한 프로세스만이 사용할 수 있어야 한다
- 점유 대기 : 자원을 가지고 있는 상태에서 다른 프로세스가 사용하고 있는 자원의 반납을 기다리는 것
- 비선점 : 다른 프로세스에 할당된 자원은 사용이 끝날 때까지 강제로 빼앗을 수 없어야 한다
- 순환 대기 : 프로세스의 집합에서 P0 → P1, P1 → P2 …등 점유한 자원을 대기하며 Pn은 P0가 점유한 자원을 요구해야 한다

예방하기 위한 방법은, 예방, 회피, 회복, 무시 가 있습니다.
- 예방 : 4가지 조건 중 하나만 해결하면 된다
- 회피 : 발생 조건이 발생하지 않도록 알고리즘을 적용하는 방법
- 회복 : 교착상태가 발생하면, 발생 이후에 문제를 해결하는 방법
- 무시 : 교착 상태에 의한 성능 저하보다, 이를 해결할 때의 성능저하가 큰 경우 그냥 무시한다.

---
### 낙관적 락(Optimistic Lock)은 충돌이 적을 것이라고 가정하고 작동합니다. 만약 충돌이 빈번하게 발생한다면 낙관적 락의 성능은 어떻게 될까요? 낙관적 락의 장점과 단점을 비교 설명해주세요.

낙관적 락 방식에서, 충돌이 발생한다면 기존에 존재하던 스레드가 롤백됩니다. 만약 충돌이 빈번하게 발생한다면, 자원이 소모되고 성능은 저하될 것입니다.

낙관적 락의 장점은, 낮은 오버헤드와 병렬 처리가 강화된다는 것입니다. 

단점은 롤백 비용이 발생하고 충돌 시 성능이 저하되는 것입니다.  

---
### 데이터베이스 커넥션 풀 또는 스레드 풀을 설계할 때 세마포어(Semaphore)를 어떻게 활용할 수 있을까요? 세마포어의 장점을 활용하여 자원 관리 효율성을 높이는 방안을 설명해주세요.

커넥션 풀이란, 데이터베이스 연결(커넥션)을 미리 여러 개 만들어두고 관리하는 공간
→ 클라이언트 요청이 오면 connection 객체를 빌려주고, 해당 객체 임무가 완료되면 다시 Connection 객체를 반납해 pool에 저장한다

세마포어를 이용하여 클라이언트의 요청을 받고, 남은 커넥션 풀이 없다면 요청을 하는 클라이언트를 대기하도록 한다. 여러 개의 자원을 동시에 관리할 수 있기 때문에 효율적으로 커넥션을 관리할 수 있을 것이다. 또한 FIFO 방식을 사용하기 때문에 기아상태를 해결할 수 있다.